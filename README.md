PDF Squasher
============

Low-Level PDF manipulation tool to squash repetitive rectangles into one
(resulting in a smaller, simpler PDF file).

Copyright (C) 2016 Assaf Gordon (assafgordon@gmail.com)
License: GPLv3 or later

I'm indebted to Russell Nathan Hyer, maintainer of GNU PDF,
for his patience and great assistance.

web-page and online squasher: <http://agordon.github.io/pdf-squasher>

source: <https://github.com/agordon/pdf-squasher/>


Installation
============

The following are required:

* Python 2.X is required (3 not yet supprted).
* [mupdf](http://mupdf.com)
* [qpdf](http://qpdf.sourceforge.net)
* [R](https://www.r-project.org) (optional, for the demo script)

On Debian/Ubuntu:

    apt-get install -y qpdf mupdf mupdf-tools

On Mac OS X:

    brew install qpdf
    brew install mupdf

The script `pdf-squasher.py` is a stand-alone script,
copy it to a location in your path (e.g. `/usr/local/bin`).


Example
=======

Online: <http://agordon.github.io/pdf-squasher>

Run locally: Run `./demo.sh` to generate a PDF plot file and squash it.




Short Details
=============

Often times, PDF files generated by data plotting (e.g from R) will contain
multiple repetitive PDF 'rectangle' commands/objects.
Large number of objects result in slower display, larger files, and more
combursome manipulation (e.g. in Adobe Illustrator or Inkscape).
This tool simply scans a PDF file, and squashes repetitive rectangles into one.

Example: PDF rectangles before squashing (the values represent `X Y W H`
coordinates, `re` is rectangle, `f` is fill):

    1420.1 4710.9 159.598 101.902 re f
    1420.1 4812.8 159.598 101.898 re f
    1420.1 4914.6 159.598 101.898 re f

The first rectangle overlaps the second (`4710.9+1-1.902 >= 4812.8`),
and similarly the second overlaps the third. This tool will squash them into
one:

    1420.1 4710.9 159.598 305.598 re f


FAQ
===

1.  Is this tool equivalent to PDF compression?

    No. Compression is unrelated (though after squashing, the resulting PDF
    file size will be smaller as well).

2.  Will this improve all pdf plots?

    No. Only plots composed of repetitve rectangles will benefit.
    If your plot is made out of thousands of non-overlapping (or not adjacent)
    points, there will be no improvement.

3.  Will this tool manipulate the displayed data?

    The resulting output should be very similar to the original input,
    but it is always your responsibility to examine the output and compare
    it to the original file.

4.  PDF Recommendations?

    Generate PDF directly in R (using the `pdf` output device).
    If using Postscript output (`.ps` files), convert to PDF using the
    `ps2pdf` command line program. *DO NOT* use Mac-OS-X built-in
    preview program or its 'Export to PDF' method - as the exported PDF
    will contain many superfluous drawing commands which will prevent
    squashing.
